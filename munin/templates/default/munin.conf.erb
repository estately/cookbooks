########################################################################
### NOTICE: this file managed by chef; changes made here will be lost.
########################################################################

dbdir   /var/lib/munin
htmldir <%= node.munin.htmldir %>
logdir  /var/log/munin
rundir  /var/run/munin
tmpldir /etc/munin/templates

<% if @alert_enabled %>
contact.alert.command mail -s "<%= @email_subject %>" <%= @email_address %>
contact.alert.always_send warning critical
<% end %>

# load config files
includedir /etc/munin/munin-conf.d

<% @hosts.sort_by {|h| h[:fqdn] }.each do |host| %>
<%
    if host[:munin]
      group = host[:munin][:group] || nil
    else
      group = host[:group] || nil
    end

    section = [
        host[:app_environment],
        group,
        host[:fqdn]
    ].join(';')

   alert_items = ""
   alerts = @alerts[ host[:fqdn] ] if @alert_enabled
   alerts.each {|a| alert_items << "#{a}\n    " } if !alerts.nil?

%>
[<%= node.munin.domain %>;<%= section %>]
    address <%= host[:fqdn] %>
    <%= alert_items %>
<% end %>
